CREATE SCHEMA ESTC_III;
USE ESTC_III;

CREATE TABLE IF NOT EXISTS CARGOS(
    ID_CARGO INT PRIMARY KEY,
    NOME_CARGO VARCHAR(50) NOT NULL,
    FUNCOES VARCHAR(100) NOT NULL,
    SALARIO DECIMAL(8,3)
);

CREATE TABLE IF NOT EXISTS TIPO_ENDERECO(
    COD_TIPO_END INT PRIMARY KEY,
    NOME_TIPO_END VARCHAR(50) NOT NULL
);

CREATE TABLE IF NOT EXISTS ENDERECOS(
    ID_ENDERECO INT PRIMARY KEY,
    NOME_RUA VARCHAR(50) NOT NULL,
    BAIRRO VARCHAR(50) NOT NULL,
    CIDADE VARCHAR(50) NOT NULL,
    UF VARCHAR(2) NOT NULL,
    PAIS VARCHAR(50) NOT NULL,
    CEP VARCHAR(8),
    TIPO_ENDERECO INT NOT NULL,
    CONSTRAINT FK_TIPO_ENDERECOS_ENDERECOS FOREIGN KEY (TIPO_ENDERECO) REFERENCES TIPO_ENDERECO(COD_TIPO_END)
);

CREATE TABLE IF NOT EXISTS EMPREGADOS(
    NMR_MATRICULA INT PRIMARY KEY,
    NOME_FUNC VARCHAR(100),
    CPF_FUNC VARCHAR(14),
    DATA_ADMISS DATE NOT NULL,
    QUALIF_FUNC VARCHAR(45),
    CARGO INT NOT NULL,
    ENDERECO INT,
    CONSTRAINT FK_CARGO_EMPREGADOS FOREIGN KEY(CARGO) REFERENCES CARGOS(ID_CARGO),
    CONSTRAINT FK_ENDERECOS_EMPREGADOS FOREIGN KEY(ENDERECO) REFERENCES ENDERECOS(ID_ENDERECO)
);

CREATE TABLE IF NOT EXISTS TELEFONES_EMPREGADOS(
    COD_TELEF_EMPG INT PRIMARY KEY,
    TLF_EMPG VARCHAR(11) NOT NULL,
    EMPREGADO INT NOT NULL,
    CONSTRAINT FK_EMPREGADOS_TELEFONES FOREIGN KEY (EMPREGADO) REFERENCES EMPREGADOS(NMR_MATRICULA)
);

CREATE TABLE IF NOT EXISTS PRODUTO(
    COD_PROD INT PRIMARY KEY,
    NOME_PROD VARCHAR(50) NOT NULL,
    DIMENSOES_PROD VARCHAR(30) NOT NULL,
    COR_PROD VARCHAR(30) NOT NULL,
    TEMP_FAB_PROD VARCHAR(30) NOT NULL,
    QNT_PROD_ESTQ INT NOT NULL
);

CREATE TABLE IF NOT EXISTS EMPREGADOS_PRODUTOS(
    PRODUTO INT,
    FUNCIONARIO INT,
    HORAS_TRABALHADAS VARCHAR(4) NOT NULL,
    PRIMARY KEY(PRODUTO, FUNCIONARIO),
    CONSTRAINT FK_PRODUTO_EMPREGADOS FOREIGN KEY(PRODUTO) REFERENCES PRODUTO(COD_PROD),
    CONSTRAINT FK_FUNCIONARIO_EMPREGADOS FOREIGN KEY(FUNCIONARIO) REFERENCES EMPREGADOS(NMR_MATRICULA)
);

CREATE TABLE IF NOT EXISTS MAQUINAS(
    MAQ_COD INT PRIMARY KEY,
    MAQ_NOME VARCHAR(50) NOT NULL,
    MAQ_TEMPO_VIDA VARCHAR(5) NOT NULL,
    MAR_DATA_COMPRA DATE NOT NULL,
    MAQ_DATA_FIM_GART DATE NOT NULL
);

CREATE TABLE IF NOT EXISTS MAQUINAS_PRODUTOS(
    MAQUINA INT,
    PRODUTO_UTLZ INT,
    HORAS_UTLZ VARCHAR(5) NOT NULL,
    PRIMARY KEY(MAQUINA, PRODUTO_UTLZ),
    CONSTRAINT FK_MAQUINA_MAQUINAS_PRODUTOS FOREIGN KEY (MAQUINA) REFERENCES MAQUINAS(MAQ_COD),
    CONSTRAINT FK_PRODUTO_MAQUINAS_PRODUTOS FOREIGN KEY (PRODUTO_UTLZ) REFERENCES PRODUTO(COD_PROD)
);

CREATE TABLE IF NOT EXISTS REGISTRO_MANUTENCAO(
    RM_COD INT PRIMARY KEY,
    RM_DATA DATE NOT NULL,
    RM_DESC TEXT NOT NULL,
    RM_MAQUINA INT NOT NULL,
    CONSTRAINT FK_MAQUINA_REGISTRO_MANUTENCAO FOREIGN KEY (RM_MAQUINA) REFERENCES MAQUINAS(MAQ_COD)
);

CREATE TABLE IF NOT EXISTS TIPO_COMPONENTE(
    TPDC_COD INT PRIMARY KEY,
    TPDC_NOME VARCHAR(50) NOT NULL,
    TDCP_QNT_ESTQ DECIMAL(10,3) NOT NULL
);

CREATE TABLE IF NOT EXISTS COMPONENTES(
    COMP_COD INT PRIMARY KEY,
    COMP_NOME VARCHAR(50) NOT NULL,
    COMP_UNIDADE VARCHAR(30) NOT NULL,
    COMP_QNT_ESTQ DECIMAL(10,3) NOT NULL,
    COMP_TIPO INT NOT NULL,
    CONSTRAINT FK_TIPO_COMPONENTE FOREIGN KEY(COMP_TIPO) REFERENCES TIPO_COMPONENTE(TPDC_COD)
);

CREATE TABLE IF NOT EXISTS PRODUTOS_COMPONENTES(
    COMPONENTE INT,
    PROD_PRDZ INT,
    PRIMARY KEY(COMPONENTE, PROD_PRDZ),
    CONSTRAINT FK_COMPONENTE_PRODUTOS FOREIGN KEY(COMPONENTE) REFERENCES COMPONENTES(COMP_COD),
    CONSTRAINT FK_PRODUTO_PRODUTOS FOREIGN KEY(PROD_PRDZ) REFERENCES PRODUTO(COD_PROD)
);

CREATE TABLE IF NOT EXISTS RECURSOS_ESPECIFICOS(
    RE_ID INT PRIMARY KEY,
    RE_HORAS_MAO_OBRA VARCHAR(5) NOT NULL,
    RE_DATA DATE NOT NULL,
    RE_TEMPO_MAQ VARCHAR(5) NOT NULL
);

CREATE TABLE IF NOT EXISTS EMPRESAS(
    EMPRESA_CNPJ VARCHAR(14) PRIMARY KEY,
    EMPRESA_RAZAO_SOCIAL VARCHAR(50) NOT NULL,
    EMPRESA_RAMO VARCHAR(50) NOT NULL,
    EMPRESA_CONT VARCHAR(14) NOT NULL,
    EMPRESA_END INT NOT NULL,
    CONSTRAINT FK_ENDERECOS_EMPRESAS FOREIGN KEY(EMPRESA_END) REFERENCES ENDERECOS(ID_ENDERECO)
);

CREATE TABLE IF NOT EXISTS TELEFONES_EMPRESAS(
    ID_TELF_EMP INT PRIMARY KEY,
    EMPRESA VARCHAR(14),
    TELEFONE VARCHAR(14) NOT NULL,
    CONSTRAINT FK_EMPRESAS_TELEFONES_EMPRESAS FOREIGN KEY(EMPRESA) REFERENCES EMPRESAS(EMPRESA_CNPJ)
);

CREATE TABLE IF NOT EXISTS FORNECEDORES(
    FORN_ID INT PRIMARY KEY,
    CONT_PESSOA VARCHAR(50) NOT NULL,
    FORN_NMR VARCHAR(14) NOT NULL,
    FORN_CNPJ VARCHAR(14) NOT NULL,
    FORN_ENDERECO INT NOT NULL,
    CONSTRAINT FK_EMPRESAS_FORNECEDORES FOREIGN KEY (FORN_CNPJ) REFERENCES EMPRESAS(EMPRESA_CNPJ),
    CONSTRAINT FK_ENDERECOS_FORNECEDORES FOREIGN KEY (FORN_ENDERECO) REFERENCES ENDERECOS(ID_ENDERECO)
);

CREATE TABLE IF NOT EXISTS COMPONENTES_FORNECEDORES(
    COMPONENTE INT,
    FORNECEDOR_COMP INT,
    PRECO_UNT DECIMAL(8,3) NOT NULL,
    CONSTRAINT FK_COMPONENTE_COMPONENTES_FORNECEDORES FOREIGN KEY (COMPONENTE) REFERENCES COMPONENTES(COMP_COD),
    CONSTRAINT FK_FORNECEDOR_COMPONENTES_FORNECEDORES FOREIGN KEY (FORNECEDOR_COMP) REFERENCES FORNECEDORES(FORN_ID)
);

CREATE TABLE IF NOT EXISTS REGISTRO_RESSUPRIMENTO(
    RS_COD INT PRIMARY KEY,
    RS_DATA DATE NOT NULL,
    RS_QNT_NECES DECIMAL(8,3) NOT NULL,
    RS_COMP INT NOT NULL,
    RS_FORN INT NOT NULL, 
    CONSTRAINT FK_COMPONENTE_REGISTRO_RESSUPRIMENTO FOREIGN KEY (RS_COMP) REFERENCES COMPONENTES(COMP_COD),
    CONSTRAINT FK_FORNECEDOR_REGISTRO_RESSUPRIMENTO FOREIGN KEY (RS_FORN) REFERENCES FORNECEDORES(FORN_ID)
);

CREATE TABLE IF NOT EXISTS ENDERECOS_CLIENTES(
    ID_ENDERECOS_CLT INT PRIMARY KEY,
    RUA VARCHAR(50) NOT NULL,
    BAIRRO VARCHAR(50) NOT NULL,
    CIDADE VARCHAR(50) NOT NULL,
    UF VARCHAR(2) NOT NULL,
    PAIS VARCHAR(50) NOT NULL,
    CEP VARCHAR(8),
    TIPO_ENDERECO INT,
    CONSTRAINT FK_TIPO_ENDERECOS_ENDERECOS_CLIENTES FOREIGN KEY (TIPO_ENDERECO) REFERENCES TIPO_ENDERECO(COD_TIPO_END)
);

CREATE TABLE IF NOT EXISTS CLIENTES(
    CLT_COD INT PRIMARY KEY,
    CLT_DATA_CADS DATE NOT NULL,
    CLT_PESS_CONT VARCHAR(50) NOT NULL,
    CLT_NMR_CONT VARCHAR(14) NOT NULL,
    CLT_CNPJ VARCHAR(14) NOT NULL,
    CONSTRAINT FK_EMPRESAS_CLIENTES FOREIGN KEY (CLT_CNPJ) REFERENCES EMPRESAS(EMPRESA_CNPJ)
);

CREATE TABLE IF NOT EXISTS ENCOMENDAS(
    ENCOM_COD INT PRIMARY KEY,
    ENCOM_DATA DATE NOT NULL,
    ENCOM_CLT INT NOT NULL,
    CONSTRAINT FK_CLIENTES_ENCOMENDAS FOREIGN KEY (ENCOM_CLT) REFERENCES CLIENTES(CLT_COD)
);

CREATE TABLE IF NOT EXISTS PAGAMENTOS(
    PAG_COD INT PRIMARY KEY,
    PAG_VLR_TOTAL DECIMAL(10,3) NOT NULL,
    PAG_VLR_DESC DECIMAL(10,3) NOT NULL,
    PAG_DATA DATE NOT NULL,
    PAG_QNT_PARCELAS INT NOT NULL,
    PAG_ENCOM INT NOT NULL,
    CONSTRAINT FK_ENCOMENDAS_PAGAMENTOS FOREIGN KEY (PAG_ENCOM) REFERENCES ENCOMENDAS(ENCOM_COD)
);

CREATE TABLE IF NOT EXISTS PRODUTOS_ENCOMENDAS(
    ENCM_COD INT NOT NULL,
    PROD_COD INT NOT NULL,
    QNT_PROD INT NOT NULL,
    PRIMARY KEY (ENCM_COD, PROD_COD),
    CONSTRAINT FK_ENCOMENDAS_PRODUTOS FOREIGN KEY (ENCM_COD) REFERENCES ENCOMENDAS(ENCOM_COD),
    CONSTRAINT FK_PRODUTOS_PRODUTOS_ENCOMENDAS FOREIGN KEY (PROD_COD) REFERENCES PRODUTO(COD_PROD)
);

-- DML'S PARA A TABELA CARGOS
INSERT INTO CARGOS (ID_CARGO, NOME_CARGO, FUNCOES, SALARIO) VALUES (1, 'Gerente', 'Gerenciar equipe', 5000.000), (2, 'Analista', 'Análise de dados', 3000.000); 
UPDATE CARGOS SET SALARIO = 5500.000 WHERE ID_CARGO = 1;

-- DML'S PARA A TABELA TIPO_ENDERECO
INSERT INTO TIPO_ENDERECO (COD_TIPO_END, NOME_TIPO_END) VALUES (1, 'Residencial'), (2, 'Comercial'); 
UPDATE TIPO_ENDERECO SET NOME_TIPO_END = 'Industrial' WHERE COD_TIPO_END = 2;

-- DML'S PARA A TABELA ENDERECOS
INSERT INTO ENDERECOS (ID_ENDERECO, NOME_RUA, BAIRRO, CIDADE, UF, PAIS, CEP, TIPO_ENDERECO) VALUES (1, 'Rua 1', 'Bairro A', 'Cidade A', 'SP', 'Brasil', '12345678', 1), (2, 'Rua 2', 'Bairro B', 'Cidade B', 'RJ', 'Brasil', '87654321', 2); 
UPDATE ENDERECOS SET NOME_RUA = 'Rua Alterada' WHERE ID_ENDERECO = 1;

-- DML'S PARA A TABELA EMPREGADOS
INSERT INTO EMPREGADOS (NMR_MATRICULA, NOME_FUNC, CPF_FUNC, DATA_ADMISS, QUALIF_FUNC, CARGO, ENDERECO) VALUES (1, 'João Silva', '12345678901', '2020-01-01', 'Superior Completo', 1, 1), (2, 'Maria Souza', '10987654321', '2021-05-10', 'Médio Completo', 2, 2); 
UPDATE EMPREGADOS SET NOME_FUNC = 'João S. Silva' WHERE NMR_MATRICULA = 1;

-- DML'S PARA A TABELA TELEFONES_EMPREGADOS
INSERT INTO TELEFONES_EMPREGADOS (COD_TELEF_EMPG, TLF_EMPG, EMPREGADO) VALUES (1, '11987654321', 1), (2, '21987654321', 2); 
UPDATE TELEFONES_EMPREGADOS SET TLF_EMPG = '11999999999' WHERE COD_TELEF_EMPG = 1;

-- DML'S PARA A TABELA PRODUTO
INSERT INTO PRODUTO (COD_PROD, NOME_PROD, DIMENSOES_PROD, COR_PROD, TEMP_FAB_PROD, QNT_PROD_ESTQ) VALUES (1, 'Produto A', '10x10x10', 'Azul', '2021', 100), (2, 'Produto B', '20x20x20', 'Verde', '2022', 200); 
UPDATE PRODUTO SET QNT_PROD_ESTQ = 150 WHERE COD_PROD = 1;

-- DML'S PARA A TABELA EMPREGADOS_PRODUTOS
INSERT INTO EMPREGADOS_PRODUTOS (PRODUTO, FUNCIONARIO, HORAS_TRABALHADAS) VALUES (1, 1, '8'), (2, 2, '4'); 
UPDATE EMPREGADOS_PRODUTOS SET HORAS_TRABALHADAS = '5' WHERE PRODUTO = 2 AND FUNCIONARIO = 2;

-- DML'S PARA A TABELA MAQUINAS
INSERT INTO MAQUINAS (MAQ_COD, MAQ_NOME, MAQ_TEMPO_VIDA, MAR_DATA_COMPRA, MAQ_DATA_FIM_GART) VALUES (1, 'Máquina A', '10 anos', '2018-01-01', '2028-01-01'), (2, 'Máquina B', '8 anos', '2020-05-10', '2028-05-10'); 
UPDATE MAQUINAS SET MAQ_NOME = 'Máquina A Atualizada' WHERE MAQ_COD = 1;

-- DML'S PARA A TABELA MAQUINAS_PRODUTOS
INSERT INTO MAQUINAS_PRODUTOS (MAQUINA, PRODUTO_UTLZ, HORAS_UTLZ) VALUES (1, 1, '5'), (2, 2, '3'); 
UPDATE MAQUINAS_PRODUTOS SET HORAS_UTLZ = '4' WHERE MAQUINA = 1 AND PRODUTO_UTLZ = 1;

-- DML'S PARA A TABELA REGISTRO_MANUTENCAO
INSERT INTO REGISTRO_MANUTENCAO (RM_COD, RM_DATA, RM_DESC, RM_MAQUINA) VALUES (1, '2023-10-01', 'Manutenção preventiva', 1), (2, '2023-10-15', 'Troca de peças', 2); 
UPDATE REGISTRO_MANUTENCAO SET RM_DESC = 'Manutenção corretiva' WHERE RM_COD = 1;

-- DML'S PARA A TABELA TIPO_COMPONENTE
INSERT INTO TIPO_COMPONENTE (TPDC_COD, TPDC_NOME, TDCP_QNT_ESTQ) VALUES (1, 'Tipo A', 100.000), (2, 'Tipo B', 200.000); 
UPDATE TIPO_COMPONENTE SET TDCP_QNT_ESTQ = 150.000 WHERE TPDC_COD = 1;

-- DML'S PARA A TABELA COMPONENTES
INSERT INTO COMPONENTES (COMP_COD, COMP_NOME, COMP_UNIDADE, COMP_QNT_ESTQ, COMP_TIPO) VALUES (1, 'Componente A', 'unidades', 50.000, 1), (2, 'Componente B', 'kg', 75.000, 2); 
UPDATE COMPONENTES SET COMP_QNT_ESTQ = 60.000 WHERE COMP_COD = 1;

-- DML'S PARA A TABELA PRODUTOS_COMPONENTES
INSERT INTO PRODUTOS_COMPONENTES (COMPONENTE, PROD_PRDZ) VALUES (1, 1), (2, 2); 
UPDATE PRODUTOS_COMPONENTES SET PROD_PRDZ = 1 WHERE COMPONENTE = 1 AND PROD_PRDZ = 2;

-- DML'S PARA A TABELA RECURSOS_ESPECIFICOS
INSERT INTO RECURSOS_ESPECIFICOS (RE_ID, RE_HORAS_MAO_OBRA, RE_DATA, RE_TEMPO_MAQ) VALUES (1, '5', '2023-10-01', '3'), (2, '6', '2023-10-15', '2'); 
UPDATE RECURSOS_ESPECIFICOS SET RE_HORAS_MAO_OBRA = '7' WHERE RE_ID = 1;

-- DML'S PARA A TABELA EMPRESAS
INSERT INTO EMPRESAS (EMPRESA_CNPJ, EMPRESA_RAZAO_SOCIAL, EMPRESA_RAMO, EMPRESA_CONT, EMPRESA_END) VALUES ('12345678000195', 'Empresa A', 'Serviços', '12345678901', 1), ('98765432000196', 'Empresa B', 'Comércio', '10987654321', 2); 
UPDATE EMPRESAS SET EMPRESA_RAMO = 'Indústria' WHERE EMPRESA_CNPJ = '12345678000195';

-- DML'S PARA A TABELA TELEFONES_EMPRESAS
INSERT INTO TELEFONES_EMPRESAS (ID_TELF_EMP, EMPRESA, TELEFONE) VALUES (1, '12345678000195', '1122334455'), (2, '98765432000196', '1199887766'); 
UPDATE TELEFONES_EMPRESAS SET TELEFONE = '1133445566' WHERE ID_TELF_EMP = 1;

-- DML'S PARA A TABELA FORNECEDORES
INSERT INTO FORNECEDORES (FORN_ID, CONT_PESSOA, FORN_NMR, FORN_CNPJ, FORN_ENDERECO) VALUES (1, 'Fornecedor A', '12345678901', '12345678000195', 1), (2, 'Fornecedor B', '98765432100', '98765432000196', 2); 
UPDATE FORNECEDORES SET CONT_PESSOA = 'Fornecedor A Atualizado' WHERE FORN_ID = 1;

-- DML'S PARA A TABELA COMPONENTES_FORNECEDORES
INSERT INTO COMPONENTES_FORNECEDORES (COMPONENTE, FORNECEDOR_COMP, PRECO_UNT) VALUES (1, 1, 100.000), (2, 2, 200.000); 
UPDATE COMPONENTES_FORNECEDORES SET PRECO_UNT = 110.000 WHERE COMPONENTE = 1 AND FORNECEDOR_COMP = 1;

-- DML'S PARA A TABELA REGISTRO_RESSUPRIMENTO
INSERT INTO REGISTRO_RESSUPRIMENTO (RS_COD, RS_DATA, RS_QNT_NECES, RS_COMP, RS_FORN) VALUES (1, '2023-10-01', 50.000, 1, 1), (2, '2023-10-15', 75.000, 2, 2); 
UPDATE REGISTRO_RESSUPRIMENTO SET RS_QNT_NECES = 60.000 WHERE RS_COD = 1;
